# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: document-intel-and-aisearch-indexing
metadata:
    template: azd-init@1.14.0
services:
    aisearch-app:
        project: src/AiSearchIndexingFunction
        host: containerapp
        language: dotnet
        docker:
            context: ../..
            dockerfile: src/AiSearchIndexingFunction/Dockerfile
    custom-field-app:
        project: src/CustomFieldExtractionFunction
        host: containerapp
        language: dotnet
        docker:
            context: ../..
            dockerfile: src/CustomFieldExtractionFunction/Dockerfile
    intelligence-app:
        project: src/DocumentIntelligenceFunction
        host: containerapp
        language: dotnet
        docker:
            context: ../..
            dockerfile: src/DocumentIntelligenceFunction/Dockerfile
    askquestions-app:
        project: src/DocumentQuestionsFunction
        host: containerapp
        language: dotnet
        docker:
            context: ../..
            dockerfile: src/DocumentQuestionsFunction/Dockerfile
    queueing-app:
        project: src/DocumentQueueingFunction
        host: containerapp
        language: dotnet
        docker:
            context: ../..
            dockerfile: src/DocumentQueueingFunction/Dockerfile
    mover-app:
        project: src/ProcessedFileMover
        host: containerapp
        language: dotnet
        docker:
            context: ../..
            dockerfile: src/ProcessedFileMover/Dockerfile

infra:
  bicep: ./infra/main.bicep

hooks:
  preup: 
    - shell: pwsh
      run: ./scripts/preup.ps1
  postpackage:
    - shell: pwsh
      run: ./scripts/postpackage.ps1
  postdeploy:
    - shell: pwsh
      run: ./scripts/postdeploy.ps1